# PointAttN ç‰™åˆ—è®­ç»ƒ - å®Œæ•´è®¾ç½®æ€»ç»“

## ğŸ¯ ç›®æ ‡
è®­ç»ƒPointAttNæ¨¡å‹æ¥é¢„æµ‹ç‰™åˆ—ä¸‹åŠéƒ¨åˆ†çš„ç¼ºå¤±ç‰™é½¿ã€‚

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### æ•°æ®é¢„å¤„ç†
- **`preprocess_jaw_data.py`** - ä¸»è¦é¢„å¤„ç†è„šæœ¬
- **`test_preprocessing.py`** - ç¯å¢ƒå’Œæ•°æ®æµ‹è¯•è„šæœ¬
- **`excluded_samples.py`** - æ’é™¤æ ·æœ¬åˆ—è¡¨ï¼ˆ107ä¸ªæœ‰é—®é¢˜çš„æ ·æœ¬ï¼‰
- **`test_exclusion.py`** - æ’é™¤åŠŸèƒ½æµ‹è¯•è„šæœ¬

### é…ç½®æ–‡ä»¶
- **`cfgs/PointAttN_Jaw.yaml`** - ç‰™åˆ—æ•°æ®ä¸“ç”¨é…ç½®æ–‡ä»¶

### è®­ç»ƒè„šæœ¬
- **`train_jaw.py`** - ç‰™åˆ—æ•°æ®ä¸“ç”¨è®­ç»ƒè„šæœ¬
- **`run_jaw_training.sh`** - ä¸€é”®è¿è¡Œè„šæœ¬

### æ–‡æ¡£
- **`README_æ•°æ®é¢„å¤„ç†.md`** - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- **`SETUP_SUMMARY.md`** - æœ¬æ–‡æ¡£

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰
```bash
./run_jaw_training.sh
```

### åˆ†æ­¥è¿è¡Œ
```bash
# 1. æµ‹è¯•æ’é™¤åŠŸèƒ½
python test_exclusion.py

# 2. æµ‹è¯•ç¯å¢ƒ
python test_preprocessing.py

# 3. æ•°æ®é¢„å¤„ç†
python preprocess_jaw_data.py

# 4. å¼€å§‹è®­ç»ƒ
python train_jaw.py --config cfgs/PointAttN_Jaw.yaml
```

## âš™ï¸ å…³é”®é…ç½®å‚æ•°

### æ•°æ®é¢„å¤„ç†å‚æ•° (preprocess_jaw_data.py)
```python
N_POINTS = 2048          # å®Œæ•´ç‚¹äº‘ç‚¹æ•°
TRAIN_RATIO = 0.8        # è®­ç»ƒé›†æ¯”ä¾‹
TEST_RATIO = 0.2         # æµ‹è¯•é›†æ¯”ä¾‹
N_PARTIAL_VIEWS = 8      # æ¯ä¸ªcompleteå¯¹åº”çš„partialæ•°é‡
```

### è®­ç»ƒå‚æ•° (cfgs/PointAttN_Jaw.yaml)
```yaml
batch_size: 16           # æ‰¹æ¬¡å¤§å°
num_points: 2048         # ç‚¹äº‘ç‚¹æ•°
nepoch: 300              # è®­ç»ƒè½®æ•°
lr: 0.0005              # å­¦ä¹ ç‡
dataset: 'pcn'          # æ•°æ®é›†ç±»å‹
pcnpath: ./processed_jaw_data  # æ•°æ®è·¯å¾„
```

## ğŸ“‚ æ•°æ®æµç¨‹

### è¾“å…¥æ•°æ®ç»“æ„
```
data_prepare/é‡æ ‡æ³¨åå®Œæ•´ç‰™åˆ—lower_jaw/
â”œâ”€â”€ lower_jaw1/
â”‚   â”œâ”€â”€ instance_id/
â”‚   â”‚   â”œâ”€â”€ lower.obj
â”‚   â”‚   â”œâ”€â”€ modified_seg.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ lower_jaw2/
â””â”€â”€ lower_jaw3/
```

### è¾“å‡ºæ•°æ®ç»“æ„
```
processed_jaw_data/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ complete/000/
â”‚   â””â”€â”€ partial/000/
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ complete/000/
â”‚   â””â”€â”€ partial/000/
â”œâ”€â”€ PCN.json
â””â”€â”€ category.txt
```

## ğŸ¯ Maskç­–ç•¥

### 1. Zåæ ‡åˆ†å‰²ï¼ˆä¸»è¦ç”¨äºä¸‹åŠéƒ¨åˆ†é®æŒ¡ï¼‰
- æ ¹æ®Zåæ ‡ç§»é™¤ä¸‹åŠéƒ¨åˆ†
- mask_ratio: 0.3-0.7 (éšæœº)
- æ¨¡æ‹ŸçœŸå®çš„ä¸‹åŠéƒ¨åˆ†ç¼ºå¤±

### 2. éšæœºç‰™é½¿ç§»é™¤
- éšæœºé€‰æ‹©å¹¶ç§»é™¤ç‰¹å®šç‰™é½¿
- exclude_ratio: 0.2-0.5 (éšæœº)
- å¢åŠ æ•°æ®å¤šæ ·æ€§

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹maskç­–ç•¥
åœ¨ `preprocess_jaw_data.py` ä¸­ï¼š
```python
# è°ƒæ•´Zåæ ‡åˆ†å‰²æ¯”ä¾‹
partial_mesh = get_partial_jaw_by_z_coordinate(
    mesh, labels, mask_ratio=0.5  # æ”¹ä¸ºä½ æƒ³è¦çš„æ¯”ä¾‹
)

# è°ƒæ•´ç‰™é½¿ç§»é™¤æ¯”ä¾‹
partial_mesh = get_partial_jaw_by_teeth_removal(
    mesh, labels, exclude_ratio=0.3  # æ”¹ä¸ºä½ æƒ³è¦çš„æ¯”ä¾‹
)
```

### ä¿®æ”¹è®­ç»ƒå‚æ•°
åœ¨ `cfgs/PointAttN_Jaw.yaml` ä¸­ï¼š
```yaml
# è°ƒæ•´æ‰¹æ¬¡å¤§å°ï¼ˆæ ¹æ®GPUå†…å­˜ï¼‰
batch_size: 8  # æˆ–16, 32

# è°ƒæ•´å­¦ä¹ ç‡
lr: 0.001  # æˆ–0.0001

# è°ƒæ•´è®­ç»ƒè½®æ•°
nepoch: 500  # æˆ–æ›´å¤š
```

## ğŸ“Š ç›‘æ§è®­ç»ƒ

### æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
```bash
tail -f log/jaw_experiments/jaw_lower.log
```

### æŸ¥çœ‹ä¿å­˜çš„æ¨¡å‹
```bash
ls log/jaw_experiments/
```

### å¯è§†åŒ–ç»“æœ
è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šåœ¨ `log/jaw_experiments/` ç›®å½•ä¸‹ä¿å­˜ï¼š
- è®­ç»ƒæ—¥å¿—
- æ¨¡å‹æ£€æŸ¥ç‚¹
- æœ€ä½³æ¨¡å‹ (`best_model_jaw_lower.pth`)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å†…å­˜éœ€æ±‚**: å»ºè®®8GB+å†…å­˜ï¼ŒGPUè®­ç»ƒ
2. **å­˜å‚¨ç©ºé—´**: æ ¹æ®æ•°æ®é‡é¢„ç•™è¶³å¤Ÿç©ºé—´
3. **è®­ç»ƒæ—¶é—´**: å–å†³äºæ•°æ®é‡å’Œç¡¬ä»¶ï¼Œå¯èƒ½éœ€è¦æ•°å°æ—¶åˆ°æ•°å¤©
4. **æ•°æ®è´¨é‡**: ç¡®ä¿OBJæ–‡ä»¶å’ŒJSONæ ‡ç­¾æ–‡ä»¶å®Œæ•´ä¸”å¯¹åº”

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **CUDAé”™è¯¯**: æ£€æŸ¥GPUé©±åŠ¨å’ŒPyTorchç‰ˆæœ¬
2. **å†…å­˜ä¸è¶³**: å‡å°batch_sizeæˆ–num_workers
3. **æ•°æ®åŠ è½½é”™è¯¯**: è¿è¡Œtest_preprocessing.pyæ£€æŸ¥
4. **è®­ç»ƒä¸æ”¶æ•›**: è°ƒæ•´å­¦ä¹ ç‡æˆ–æ£€æŸ¥æ•°æ®è´¨é‡

### è·å–å¸®åŠ©
- æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: `README_æ•°æ®é¢„å¤„ç†.md`
- æ£€æŸ¥è®­ç»ƒæ—¥å¿—: `log/jaw_experiments/jaw_lower.log`
- è¿è¡Œæµ‹è¯•è„šæœ¬: `python test_preprocessing.py`

## ğŸ‰ å®Œæˆï¼

å¦‚æœä¸€åˆ‡è®¾ç½®æ­£ç¡®ï¼Œè¿è¡Œ `./run_jaw_training.sh` å°±å¯ä»¥å¼€å§‹è®­ç»ƒä½ çš„ç‰™åˆ—è¡¥å…¨æ¨¡å‹äº†ï¼
